{% extends 'base.html' %}

{% block title %}Registro MTB Tandil{% endblock %}

{% block content %}
    <!-- Contact Section -->
    <section class="contact" id="contact">
        <div class="contact-container">
            <div class="contact-header">
                <h2>Estas listo para la aventura?</h2>
                <!-- <p class="contact-subtitle">
                    Los primeros 50 inscriptos a cualquier carrera se
                    llevan un kit de la marca auspiciante <span class="gratis">TOTALMENTE GRATIS!</span> 
                </p> -->
            </div>

            <div class="contact-content">
                <div class="contact-form-wrapper">
                    <div class="form-section">
                        <form id="contactForm">
                            <div class="form-header">
                                <h3>Reserva tu lugar para la carrera</h3>
                                <p>Recibiras toda la info necesaria en el correo indicado!</p>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="name">Nombre Completo</label>
                                    <input type="text" id="name" name="name" placeholder="John Doe" required>
                                </div>
                                <div class="form-group">
                                    <label for="email">Email</label>
                                    <input type="email" id="email" name="email" placeholder="john@example.com" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="subject">Carrera en la que participaras</label>
                                <select id="subject" name="subject" required>
                                    <option value="">Selecciona una carrera</option>
                                    <option value="larga">Larga - 80km</option>
                                    <option value="corta">Corta - 30km</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="message">Info importante sobre ti</label>
                                <textarea id="message" name="message" rows="6" placeholder="Problema de salud, alergia, etc..."></textarea>
                            </div>
                            <button type="submit" class="submit-button" id="reservar">Reservar</button>
                        </form>
                    </div>
                </div>
                <div class="image-section">
                    
                </div>                
            </div>
        </div>
    </section>

    {% block scripts %}
    <script>
        document.getElementById("contactForm").addEventListener('submit', (e) => {
            // Always prevent the default form submission
            e.preventDefault()
            
            const form = e.target
            const info = new FormData(form)

            fetch('http://localhost:5000/send', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    name: info.get('name'),
                    email: info.get('email'),
                    subject: info.get('subject'),
                    message: info.get('message')
                })
            }).then(res => {
                if (res.ok) {
                    alert("Inscripción realizada con éxito! Revisa tu correo para más información.")
                    window.location.href = '/'
                } else {
                    alert("Hubo un error al enviar el formulario. Por favor, intenta nuevamente.")
                }
            }).catch(error => {
                console.error('Error:', error);
                alert("Hubo un error al enviar el formulario. Por favor, intenta nuevamente.")
            })
        })
    </script>
    {% endblock scripts %}

{% endblock %}